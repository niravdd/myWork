<!doctype html>
<html class="no-js" lang="en">
<head>
	<title>Telemetry & Analytics’ Pipelines for Game Balancing - GAM310 | AWS re:Invent</title>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1 user-scalable=no">

	<!--Favicon-->
	<link rel="icon" type="image/ico" href="https://a0.awsstatic.com/main/images/site/fav/favicon.ico" /> 
	<link rel="shortcut icon" type="image/ico" href="https://a0.awsstatic.com/main/images/site/fav/favicon.ico" /> 
	<link rel="apple-touch-icon" sizes="57x57" href="https://a0.awsstatic.com/main/images/site/touch-icon-iphone-114-precomposed.png" /> 
	<link rel="apple-touch-icon" sizes="72x72" href="https://a0.awsstatic.com/main/images/site/touch-icon-ipad-144-precomposed.png" /> 
	<link rel="apple-touch-icon" sizes="114x114" href="https://a0.awsstatic.com/main/images/site/touch-icon-iphone-114-precomposed.png" /> 
	<link rel="apple-touch-icon" sizes="144x144" href="https://a0.awsstatic.com/main/images/site/touch-icon-ipad-144-precomposed.png" /> 

	<link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:300,400,700" rel="stylesheet">
	<link rel="stylesheet" href="style.css" type="text/css" media="all">
	<script src="https://sdk.amazonaws.com/js/aws-sdk-2.2.32.min.js"></script>
	<script src="gam310.js"></script>
</head>
<body class="template-aside yellow page-sessions loading" data-page="sessions">
	<div class="video">
		<div class="overlay"></div>
		<video width="100%" height="100%" autoplay loop muted poster="">
			<source src="https://reinvent.awsevents.com/_media/video/hero-yellow.mp4?20170517" type="video/mp4">
			Your browser does not support the video tag.
		</video>
	</div>
	<div class="site-wrapper">
		<div class="site-content">

<header class="site-header">
	<div class="central-column">
		<a class="site-branding" href="index.html">
			<img src="https://reinvent.awsevents.com/_media/images/branding/aws-reinvent-logo.png" alt="AWS re:Invent 2017 logo" />
			<span class="offscreen">AWS re:Invent</span>
		</a>
		<nav>
			<ul>
				<li id="help_message"><a href="javascript:void();">&nbsp;</a></li>
				<li class="border"><a href="javascript:void();" onClick="help()" class="trkAnchor">CLICK TO REQUEST HELP</a></li>
			</ul>
		</nav>
	</div>
</header>

<main class="site-main">
	<header class="page-header"> 
		<div class="central-column">
			<div class="text">
				<h2 class="headline-s1">GAM310</h2>
				<h3 class="headline-s2">Telemetry & Analytics’ Pipelines for Game Balancing</h3>
				<p class="lower-link">Lab 3 - Analytics on the Stream</p>
			</div>
		</div>
	</header>
	<div class="sections body-copy">
		<section id="section-sessions" class="page-section dark">
			<div class="central-column">
				<div class="indent">
					<p class="intro">Now that you've got a feel for a standard analytics pipeline, as well as how you can take a serverless approach, let's look at how you can analyse data as it is passing through a stream.</p>
					<div class="session">
						<h3>PIPELINE 3 - ANALYTICS ON THE STREAM</h3>
						<p>To achieve this we're going to use Kinesis Analytics. The following diagram shows the architecture of this data pipeline:</p>
						<img src="Pipeline3.png" alt="Analytics Pipeline" /><br /><br />

						<h3 class="overline">PIPELINE 3 - CONFIGURE KINESIS ANALYTICS</h3>
						<p>For this lab we're going to use Kinesis Analytics in the web console. Please visit <a href="https://us-west-2.console.aws.amazon.com/kinesisanalytics/home?region=us-west-2#/gettingstarted" target="_blank">this link</a> and create an application that uses your <span class="bold">workshopTelemetryStream</span> Kinesis Stream as the source, the Redshift table "telemetry2" as the destination, and uses the SQL statements below as the Kinesis Analytics Application. If you get stuck, step-by-step instructions are below:
						<div class="indent-show" id="1-1-button"><div class="expand"><a class="border" href="javascript:void();" onClick="reveal('1-1-button', '1-1-content')">CLICK TO TOGGLE INSTRUCTIONS</a></div></div>
						<div class="indent-hide" id="1-1-content">
							<p>
								1. Click on "Create application"<br />
								2. For "Application name" enter "telemetry2app" and click "Create application"<br />
								3. Under the "Source" section, click "Connect to a source"<br />
								4. Under "Select a stream" select "workshopTelemetryStream" and click the "Discover schema" button on the bottom left of the window. This will analyse the data that is passing through the stream and identify the schema of the data in it.<br />
								5. After about 30 seconds the data should appear. Check that it looks sensible and click "Save and continue"<br />
								6. Under the "Real time analytics" section click the "Go to SQL editor" button<br />
								7. A window will appear asking "Would you like to start running telemetry2app?". Click "Yes, start application"<br />
								8. Copy both the following SQL statements into the query editor and click the "Save and run SQL" button on the middle-right side of the window:<br />
							</p>							
						</div>
						<div id="code1">CREATE OR REPLACE STREAM "WORKSHOP_TELEMETRY2_FH_STREAM" (
	"playerid" bigint, "playerlevel" VARCHAR(16), "squadelementmap" VARCHAR(8), "gamenumber" integer, "squadpower" integer, "squadagility" integer, "squadhealth" integer, "squadluck" integer, "squadspecial" integer,
	"squadguard" integer, "squaddamage" integer, "gameplayseconds" integer, "bosspower" integer, "bossagility" integer, "bosshealth" integer, "bossluck" integer, "bossspecial" integer, "bossguard" integer, "bossdamage" integer, "result" VARCHAR(8));

CREATE OR REPLACE PUMP "STREAM_PUMP" AS INSERT INTO "WORKSHOP_TELEMETRY2_FH_STREAM" 
SELECT STREAM "playerid", "playerlevel", "squadelementmap", "gamenumber", "squadpower", "squadagility", "squadhealth", "squadluck", "squadspecial",
	"squadguard", "squaddamage", "gameplayseconds", "bosspower", "bossagility", "bosshealth", "bossluck", "bossspecial", "bossguard", "bossdamage", "COL_result"
FROM "SOURCE_SQL_STREAM_001" where "gamenumber"=1;
</div><br />
							<p> 9. You should see the data appear in the "Real-time analytics" tab. This is real-time data. Let's see what happens when you change the query. Please change the query to the following SQL statements and click the "Save and run SQL" button on the middle-right side of the window:</p>
						<div id="code2">CREATE OR REPLACE STREAM "WORKSHOP_TELEMETRY2_FH_STREAM" (
	"playerid" bigint, "playerlevel" VARCHAR(8), "squadelementmap" VARCHAR(8), "gamenumber" integer, "squadpower" integer, "squadagility" integer, "squadhealth" integer, "squadluck" integer, "squadspecial" integer,
	"squadguard" integer, "squaddamage" integer, "gameplayseconds" integer, "bosspower" integer, "bossagility" integer, "bosshealth" integer, "bossluck" integer, "bossspecial" integer, "bossguard" integer, "bossdamage" integer, "result" VARCHAR(4));

CREATE OR REPLACE PUMP "STREAM_PUMP" AS INSERT INTO "WORKSHOP_TELEMETRY2_FH_STREAM" 
SELECT STREAM "playerid", "playerlevel", "squadelementmap", "gamenumber", "squadpower", "squadagility", "squadhealth", "squadluck", "squadspecial",
	"squadguard", "squaddamage", "gameplayseconds", "bosspower", "bossagility", "bosshealth", "bossluck", "bossspecial", "bossguard", "bossdamage", "COL_result"
FROM "SOURCE_SQL_STREAM_001" where "COL_result"='DNF';
</div><br />
							<p> 10. Once you see the real-time data showing up and can see that it only shows DNF in the "result" column, click the "Destination" tab in the middle-left of the window<br />
								11. Click the "Connect to a destination" button<br />
								12. Under "Select a stream" select "workshopTelemetryFHDirect"<br />
								13. For "In-application stream name" select "WORKSHOP_TELEMETRY2_FH_STREAM" and click the "Save and continue" button<br /><br />
							Congratulations, you've configured Kinesis Analytics! You can now click the "Go to SQL Results" if you want to see the results being processed in real-time, and you can also wait a few minutes and then query the results in Redshift that the Firehose Stream has inserted.<br /><br />
							To do so, SSH into your instance, use the PGCLI command from your CloudFormation Stack Output, and enter the following query:<br />
							</p>
							<div id="code3">SELECT * FROM telemetry2 LIMIT 10;
							</div>

						<h3 class="overline">OPTIONAL - PIPELINE 3 - CONFIGURE QUICKSIGHT FOR REDSHIFT</h3>
						<p>If you want to, you can configure QuickSight to view the data you're processing with Kinesis Analytics and pushing to Redshift.</p>
						<div class="indent-show" id="1-10-button"><div class="expand"><a class="border" href="javascript:void();" onClick="reveal('1-10-button', '1-10-content')">CLICK TO TOGGLE INSTRUCTIONS</a></div></div>
						<div class="indent-hide" id="1-10-content"><br />
							<p>QuickSight requires access to your S3 buckets. This can be done through your account settings, which are only available in N. Virginia. Go to Account Settings, then Account Permissions, and click the "Edit AWS permissions" button.</p>
							<p>1. Go to <span class="bold">https://quicksight.aws</span>.</p>
							<p>2. Click the "New analysis" button in the top left</p>
							<p>3. Click the "New data set" button in the top left</p>
							<p>4. Click the "Redshift - Auto-discovered" button</p>
							<p>5. A "New Redshift data source" window will appear. For the "Data source name" enter "GamingWorkshop". For "Instance ID" click the drop-down arrow on the right of the selection box, and select "workshopcluster". The "Database name" should be automatically populated with "workshopdb", but you will need to enter a "Username" of "wsuser" and "Password" of "wsPassword0". Click the "Validate" button on the bottom left of the window. This should turn to "Validated" with a green tick if you're successful. Click "Create data source".</p>
							<p>6. Select "telemetry2" and click the "Select" button on the bottom right</p>
							<p>7. Select "Directly query your data" and click the "Visualize" button on the bottom right</p>
							<p>8. Explore your data!</p>
							</pre>
						</div>

						<h3 class="overline">PROCEED TO LAB 4</h3>
						<p>You've now completed Lab 3!</p>
						<p>Note: When a reasonable amount of participants have progressed to this point, we will pause and present some slides explaining the next lab:</p>
						<p>If you're keen, it's perfectly fine to proceed - but it's recommended that you hit the button below and then take a break for a moment until a reasonable number of participants are ready to proceed.</p>
						<div class="indent-show" id="next-lab-button"><div class="expand"><a class="border" href="javascript:void();" onClick="nextLab('4','4')">PROCEED TO LAB 4</a></div></div>
					</div>
				</div>
			</div>
		</section>
	</div>
</main>

		</div>
	</div>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.9/ace.js"></script>
	<script>
		var code1 = ace.edit("code1");
		code1.setTheme("ace/theme/idle_fingers");
    	code1.getSession().setMode("ace/mode/snippets");
    	code1.setReadOnly(true);
    	code1.setShowPrintMargin(false);
    	code1.setOptions({
    		maxLines: code1.session.getLength()
    	});
	</script>
	<script>
		var code2 = ace.edit("code2");
		code2.setTheme("ace/theme/idle_fingers");
    	code2.getSession().setMode("ace/mode/snippets");
    	code2.setReadOnly(true);
    	code2.setShowPrintMargin(false);
    	code2.setOptions({
    		maxLines: code2.session.getLength()
    	});
	</script>
	<script>
		var code3 = ace.edit("code3");
		code3.setTheme("ace/theme/idle_fingers");
    	code3.getSession().setMode("ace/mode/snippets");
    	code3.setReadOnly(true);
    	code3.setShowPrintMargin(false);
    	code3.setOptions({
    		maxLines: code3.session.getLength()
    	});
	</script>
</body>

</html>