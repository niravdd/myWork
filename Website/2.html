<!doctype html>
<html class="no-js" lang="en">
<head>
	<title>Telemetry & Analytics’ Pipelines for Game Balancing - GAM310 | AWS re:Invent</title>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1 user-scalable=no">

	<!--Favicon-->
	<link rel="icon" type="image/ico" href="https://a0.awsstatic.com/main/images/site/fav/favicon.ico" /> 
	<link rel="shortcut icon" type="image/ico" href="https://a0.awsstatic.com/main/images/site/fav/favicon.ico" /> 
	<link rel="apple-touch-icon" sizes="57x57" href="https://a0.awsstatic.com/main/images/site/touch-icon-iphone-114-precomposed.png" /> 
	<link rel="apple-touch-icon" sizes="72x72" href="https://a0.awsstatic.com/main/images/site/touch-icon-ipad-144-precomposed.png" /> 
	<link rel="apple-touch-icon" sizes="114x114" href="https://a0.awsstatic.com/main/images/site/touch-icon-iphone-114-precomposed.png" /> 
	<link rel="apple-touch-icon" sizes="144x144" href="https://a0.awsstatic.com/main/images/site/touch-icon-ipad-144-precomposed.png" /> 

	<link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:300,400,700" rel="stylesheet">
	<link rel="stylesheet" href="style.css" type="text/css" media="all">
	<script src="https://sdk.amazonaws.com/js/aws-sdk-2.2.32.min.js"></script>
	<script src="gam310.js"></script>
</head>
<body class="template-aside yellow page-sessions loading" data-page="sessions">
	<div class="video">
		<div class="overlay"></div>
		<video width="100%" height="100%" autoplay loop muted poster="">
			<source src="https://reinvent.awsevents.com/_media/video/hero-yellow.mp4?20170517" type="video/mp4">
			Your browser does not support the video tag.
		</video>
	</div>
	<div class="site-wrapper">
		<div class="site-content">

<header class="site-header">
	<div class="central-column">
		<a class="site-branding" href="index.html">
			<img src="https://reinvent.awsevents.com/_media/images/branding/aws-reinvent-logo.png" alt="AWS re:Invent 2017 logo" />
			<span class="offscreen">AWS re:Invent</span>
		</a>
		<nav>
			<ul>
				<li id="help_message"><a href="javascript:void();">&nbsp;</a></li>
				<li class="border"><a href="javascript:void();" onClick="help()" class="trkAnchor">CLICK TO REQUEST HELP</a></li>
			</ul>
		</nav>
	</div>
</header>

<main class="site-main">
	<header class="page-header"> 
		<div class="central-column">
			<div class="text">
				<h2 class="headline-s1">GAM310</h2>
				<h3 class="headline-s2">Telemetry & Analytics’ Pipelines for Game Balancing</h3>
				<p class="lower-link">Lab 2 - Building a Serverless Analytics Pipeline</p>
			</div>
		</div>
	</header>
	<div class="sections body-copy">
		<section id="section-sessions" class="page-section dark">
			<div class="central-column">
				<div class="indent">
					<p class="intro">In the first lab, you configured Kinesis Streams and a Redshift instance, then configured Kinesis Firehose to pipe data from the Stream to Redshift. You then explored the data in QuickSight. In Lab 2 you will use Athena to see how a serverless approach can still give you interactive SQL access to your game data.</p>
					<div class="session">
						<h3>PIPELINE 2 - SERVERLESS ANALYTICS PIPELINE</h3>
						<p>In this lab you will be using the same Kinesis Stream and S3 bucket from Lab 1, but this time using Amazon Athena to consume the data. The first diagram below shows the architecture of the data pipeline we're building in this lab. You are not going to build the second diagram in this lab: we have included it to show you another great option for data processing. ElasticSearch is especially good for analyzing log files.</p>
						<img src="Pipeline2.png" alt="Analytics Pipeline" /><br /><br />
						
						<h3 class="overline">PIPELINE 2 - CONFIGURE AMAZON ATHENA</h3>
						<p>For this lab we're going to use the web console instead of the command line so we can use Amazon Athena's interactive SQL feature. Athena uses a Hive metastore as a database, and this is where you define the structure of the "tables" you will use to query S3 data.<br />
							You have two options to create your Hive metastore:
							<ul>
								<li>Create a database in AWS Glue and set up a Crawler to automatically create the table schema based on the content of your data</li>
								<li>Create a database in Athena and use a script to create your table based on prior knowledge of the data structures</li>
							</ul>
						</p>
						<div class="indent-show" id="1-1-button"><div class="expand"><a class="border" href="javascript:void();" onClick="reveal('1-1-button', '1-1-content')">OPTION 1: GLUE INSTRUCTIONS</a></div></div>
						<div class="indent-hide" id="1-1-content">
						<p>AWS Glue is a service that can be used to manage your complex data ETL requirements. To do this, you create a Database, and then set up a "Crawler" that processes the data in your S3 buckets and adds the metadata to the Database. If you want to use Glue, use the following instructions as an alternative. The fastest way to create the Hive database will be to skip Glue and move on to the instructions for using the scripts.</p>
						<p>
							1. Close the introductory tutorial window (this will not appear if you've used Athena before).<br />
							2. On the left side you will see the "DATABASE" section. Click on "Create Table" dropdown, then "Automatically (AWS Glue Crawler)". This will pop up a notification that you're going to Glue. Click "Continue".<br />
							3. Click "Get started".<br />
							4. Click on "Crawlers", then "Add crawler"<br />
							5. Enter a Crawler name of "workshopcrawler" and "Next"<br />
							6. The Data store should already have "S3" selected. Click the folder icon on the right side of the "Include path" and expand your workshop folder. It will be named "gamingworkshop-workshopbucket-XXXXXXXXXXXX". Inside that folder, click on "telemetry12017" and click the "Select" button, then "Next" on the Add a data store page.<br />
							7. Click "Next" on the "Add another data store" page ("No" should already be selected).<br />
							8. On the "Choose and IAM role" page, select "Create an IAM role" and enter "workshop" as the name, then click "Next".<br />
							9. On the "Create a scheduler for this crawler" page, click "Next" ("Run on demand" should already be selected).<br />
							10. On the "Configure the crawler's output" page, click the "Add database" button, then enter "workshoptelemetrydb" and click the "Create" button. Click "Next"<br />
							11. Click "Finish". This will create the crawler and return you to the "Crawlers" page.<br />
							12. At the top should be a green banner asking if you want to run your crawler. Click "Run it now".<br />
						</p>
						</div><br />
						<div class="indent-show" id="1-5-button"><div class="expand"><a class="border" href="javascript:void();" onClick="reveal('1-5-button', '1-5-content')">OPTION 2: ATHENA SCRIPT INSTRUCTIONS</a></div></div>
						<div class="indent-hide" id="1-5-content">
						<p>If you want to do things the fast way (and have not done this in Glue go to the Athena console page (available at <a href="https://us-west-2.console.aws.amazon.com/athena/home?region=us-west-2" target="_blank">this link</a>). You'll need to use your S3 bucket name, which is the "WorkshopBucket" Output from your CloudFormation stack. If you've closed the window, the Outputs can be found at <a href="https://us-west-2.console.aws.amazon.com/cloudformation/home?region=us-west-2#/stacks?filter=active&tab=outputs" target="_blank">this link</a>. Update the bucket name in the following script, then copy and paste it into the query editor:</p>
						<div id="code2"># Replace ${WorkshopBucket} the "WorkshopBucket" field from your CloudFormation Outputs
CREATE DATABASE IF NOT EXISTS workshoptelemetrydb
	COMMENT 'Gaming workshop telemetry database'
	LOCATION 's3://${WorkshopBucket}/workshoptelemetrydb';
</div>
</div><br />
						<p>You've just created a Hive database. Now you need to create a table. This table describes the way in which you want to read the data from your S3 bucket. Update the bucket name in the following script, then copy and paste it into the query editor, replacing the previous script. Replace ${WorkshopBucket} the "WorkshopBucket" field from your CloudFormation Outputs</p>
						<div id="code3">CREATE EXTERNAL TABLE IF NOT EXISTS workshoptelemetrydb.telemetry12017 (
	datestamp string,
	playerid bigint,
	playerlevel string,
	squadelementmap string,
	gamenumber int,
	squadpower int,
	squadagility int,
	squadhealth int,
	squadluck int,
	squadspecial int,
	squadguard int,
	squaddamage int,
	squadinventoryitemcount int,
	bosspower int,
	bossagility int,
	bosshealth int,
	bossluck int,
	bossspecial int,
	bossguard int,
	bossdamage int,
	result string 
)
ROW FORMAT SERDE 'org.openx.data.jsonserde.JsonSerDe'
WITH SERDEPROPERTIES (
	'serialization.format' = '1'
) LOCATION 's3://${WorkshopBucket}/telemetry12017/'
TBLPROPERTIES ('has_encrypted_data'='false');
</div><br />
						<p>Click "Run Query". Now that you've set up your table, let's explore the data! The following query will tell you how many wins your game bot has had in the last 30 minutes:</p>
						<div id="code4">select
	*
from
	workshoptelemetrydb.telemetry12017
where
	cast(datestamp as timestamp) > current_timestamp - INTERVAL '30' MINUTE
	limit 10;
</div>

						<h3 class="overline">PIPELINE 2 - SET UP QUICKSIGHT TO USE ATHENA</h3>
						<p>Let's get QuickSight working with Athena as a Data Source!</p>
						<div class="indent-show" id="1-10-button"><div class="expand"><a class="border" href="javascript:void();" onClick="reveal('1-10-button', '1-10-content')">CLICK TO TOGGLE INSTRUCTIONS</a></div></div>
						<div class="indent-hide" id="1-10-content"><br />
							<p>1. Click on <a href="https://quicksight.aws.amazon.com/" target="_blank">this link</a> to visit the QuickSight website or select "QuickSight" in the Console.</p>
							<p>2. QuickSight requires access to your S3 buckets. This can be done through your account settings, which are only available in N. Virginia. Select "US East (N.Virginia)" from the top-right corner</p>
							<p>3. Click on your name on the top-right corner, and select "Manage QuickSight". Click on "Account Settings", then under Account Permissions click the "Edit AWS permissions" button. Ensure "Enable autodiscovery...", "Amazon Athena" and "Amazon S3" are checked, and within S3 that your Workshop bucket is checked. Click the "Apply" button in the lower right of the window.</p>
							<p>4. Change back to the US-West-2 (Oregon) region.</p>
							<p>5. Click the "New analysis" button in the top left</p>
							<p>6. Click the "New data set" button in the top left</p>
							<p>7. Click the "Athena" button</p>
							<p>8. A "New Athena data source" window will appear. For the "Data source name" enter "GamingWorkshopAthena". Click the "Validate" button on the bottom left of the window. This should turn to "Validated" with a green tick if you're successful. Click "Create data source".</p>
							<p>9. Select "workshoptelemetrydb" and then select "telemetry12017" and click the "Select" button on the bottom right</p>
							<p>10. Select "Directly query your data" and click the "Visualize" button on the bottom right</p>
							<p>11. Explore your data!</p>
						</div>

						<h3 class="overline">PROCEED TO LAB 3</h3>
						<p>You've now completed Lab 2!</p>
						<p>Note: When a reasonable amount of participants have progressed to this point, we will pause and present some slides explaining the next lab.</p>
						<p>If you're keen, it's perfectly fine to proceed - but it's recommended that you hit the button below and then take a break for a moment until a reasonable number of participants are ready to proceed.</p>
						<div class="indent-show" id="next-lab-button"><div class="expand"><a class="border" href="javascript:void();" onClick="nextLab('3','3')">PROCEED TO LAB 3</a></div></div>
					</div>
				</div>
			</div>
		</section>
	</div>
</main>

		</div>
	</div>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.9/ace.js"></script>
	<script>
		var code1 = ace.edit("code1");
		code1.setTheme("ace/theme/idle_fingers");
    	code1.getSession().setMode("ace/mode/snippets");
    	code1.setReadOnly(true);
    	code1.setShowPrintMargin(false);
    	code1.setOptions({
    		maxLines: code1.session.getLength()
    	});
	</script>
	<script>
		var code2 = ace.edit("code2");
		code2.setTheme("ace/theme/idle_fingers");
    	code2.getSession().setMode("ace/mode/snippets");
    	code2.setReadOnly(true);
    	code2.setShowPrintMargin(false);
    	code2.setOptions({
    		maxLines: code2.session.getLength()
    	});
	</script>
	<script>
		var code3 = ace.edit("code3");
		code3.setTheme("ace/theme/idle_fingers");
    	code3.getSession().setMode("ace/mode/snippets");
    	code3.setReadOnly(false);
    	code3.setShowPrintMargin(false);
    	code3.setOptions({
    		maxLines: code3.session.getLength()
    	});
	</script>
	<script>
		var code4 = ace.edit("code4");
		code4.setTheme("ace/theme/idle_fingers");
    	code4.getSession().setMode("ace/mode/snippets");
    	code4.setReadOnly(false);
    	code4.setShowPrintMargin(false);
    	code4.setOptions({
    		maxLines: code4.session.getLength()
    	});
	</script>
</body>

</html>