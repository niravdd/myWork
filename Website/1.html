<!doctype html>
<html class="no-js" lang="en">
<head>
	<title>Telemetry &amp; Analytics' Pipelines for Game Balancing - GAM310 | AWS re:Invent 2017</title>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1 user-scalable=no">

	<!--Favicon-->
	<link rel="icon" type="image/ico" href="https://a0.awsstatic.com/main/images/site/fav/favicon.ico" /> 
	<link rel="shortcut icon" type="image/ico" href="https://a0.awsstatic.com/main/images/site/fav/favicon.ico" /> 
	<link rel="apple-touch-icon" sizes="57x57" href="https://a0.awsstatic.com/main/images/site/touch-icon-iphone-114-precomposed.png" /> 
	<link rel="apple-touch-icon" sizes="72x72" href="https://a0.awsstatic.com/main/images/site/touch-icon-ipad-144-precomposed.png" /> 
	<link rel="apple-touch-icon" sizes="114x114" href="https://a0.awsstatic.com/main/images/site/touch-icon-iphone-114-precomposed.png" /> 
	<link rel="apple-touch-icon" sizes="144x144" href="https://a0.awsstatic.com/main/images/site/touch-icon-ipad-144-precomposed.png" /> 

	<link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:300,400,700" rel="stylesheet">
	<link rel="stylesheet" href="style.css" type="text/css" media="all">
	<script src="https://sdk.amazonaws.com/js/aws-sdk-2.2.32.min.js"></script>
	<script src="gam310.js"></script>
</head>
<body class="template-aside yellow page-sessions loading" data-page="sessions">
	<div class="video">
		<div class="overlay"></div>
		<video width="100%" height="100%" autoplay loop muted poster="">
			<source src="https://reinvent.awsevents.com/_media/video/hero-yellow.mp4?20170517" type="video/mp4">
			Your browser does not support the video tag.
		</video>
	</div>
	<div class="site-wrapper">
		<div class="site-content">

<header class="site-header">
	<div class="central-column">
		<a class="site-branding" href="/index.html">
			<img src="https://reinvent.awsevents.com/_media/images/branding/aws-reinvent-logo.png" alt="AWS re:Invent 2017 logo" />
			<span class="offscreen">AWS re:Invent</span>
		</a>
		<nav>
			<ul>
				<li id="help_message"><a href="javascript:void();">&nbsp;</a></li>
				<li class="border"><a href="javascript:void();" onClick="help()" class="trkAnchor">CLICK TO REQUEST HELP</a></li>
			</ul>
		</nav>
	</div>
</header>

<main class="site-main">
	<header class="page-header"> 
		<div class="central-column">
			<div class="text">
				<h2 class="headline-s1">GAM310</h2>
				<h3 class="headline-s2">Telemetry &amp; Analytics' Pipelines for Game Balancing</h3>
				<p class="lower-link">Welcome to the Workshop!</p>
			</div>
		</div>
	</header>
	<div class="sections body-copy">
		<section id="section-sessions" class="page-section dark">
			<div class="central-column">
				<div class="indent">
					<p class="intro">In this first lab, we will set up a landing zone for the rest of the workshop, and build a standard analytics pipeline.</p>
					<div class="session">

						<h3 class="overline">DEPLOYING A LANDING ZONE</h3>
						<p>You must now set up the landing zone for your data pipelines. For this we will use glorious CloudFormation! This template will create a new VPC, subnets, routes, security groups, create a bastion host, and log in for you. We've also included Redshift at this early part of the lab as it takes a few minutes to provision.</p>
						<p id="keypair">Please enter the following command to create the foundation infrastructure, changing the "WorkshopKeyPair" if necessary:</p>
						<div id="code1">#Change ${keypair} to the name of a keypair you have access to.
aws --region us-west-2 cloudformation create-stack --stack-name GamingWorkshopStack --template-url https://s3-us-west-2.amazonaws.com/gam310-2017/gam310-workshop-cfn.yml --parameters ParameterKey=Ec2KeyPair,ParameterValue=WorkshopKeyPair --capabilities CAPABILITY_IAM
</div><br />
						<p>Alternatively, you can click <a href="https://us-west-2.console.aws.amazon.com/cloudformation/home?region=us-west-2#/stacks/new?&templateURL=https://s3-us-west-2.amazonaws.com/gam310-2017/gam310-workshop-cfn.yml" target="_blank">this link</a> to use the Web Console.</p>
						<p>This CloudFormation stack will take about 10 minutes to construct the infrastructure we need.</p>

						<h3 class="overline">PIPELINE 1 - ANALYTICS PIPELINE</h3>
						<p>Now that you have your Bastion Host configured and have logged in, let's set up your first analytics pipeline! The pipeline is described in the following diagram:<br />
							<img src="Pipeline1.png" alt="Analytics Pipeline" /><br /><br />
							Start by logging into the instance. You'll need to use your KeyPair filename, as well as the BastionPublicDNS from the Outputs of your CloudFormation stack. They can be found at <a href="https://us-west-2.console.aws.amazon.com/cloudformation/home?region=us-west-2#/stacks?filter=active&tab=outputs" target="_blank">this link</a>.
						</p>
						<div id="code2"># This command will show the Elastic IP of the Bastion Host created as part of your CloudFormation stack.
aws --region us-west-2 cloudformation describe-stack-resources --stack-name GamingWorkshopStack --query 'StackResources[?ResourceType==`AWS::EC2::EIP`].PhysicalResourceId' --output text

# Look for the BastionPublicDNS Output value, then replace ${WorkshopKeyPair.pem} with your keypair .pem file, and ${BastionPublicDNS} with the Output from your CloudFormation template. This will only work on Linux or Mac. Use PuTTY if you're using Windows.
ssh -o "ServerAliveInterval 60" -i ${WorkshopKeyPair.pem} ec2-user@${BastionPublicDNS}
</div><br />
						<p>Now that you're in the instance, you are going to create your Kinesis Streams! We've created a script that will set up your security and create the Kinesis Streams and Kinesis Firehose Streams for you. To run the script, execute the following command from your Bastion Host.</p>
						<p><div id="code3"><br />./pipeline1Script.sh<br />
						</div>
						</p>
						<p>The script will pause to allow you to copy and paste some SQL commands to create tables in Redshift. If you have problems creating the SQL commands, they are available here:</p>
						<div class="indent-show" id="1-1-button"><div class="expand"><a class="border" href="javascript:void();" onClick="reveal('1-1-button', '1-1-content')">CLICK TO TOGGLE INSTRUCTIONS</a></div></div>
						<div class="indent-hide" id="1-1-content"><p>
							<div id="code5"># Connect to the Redshift DB and create the tables in Redshift. To do this, copy the "ClusterEndpointConnectCmd" from your CloudFormation stack Output into your SSH terminal. It should look like this:
pgcli postgres://wsuser:wsPassword0@${redshiftClusterEndpoint}:5439/workshopdb --prompt "GAM310_\u@\d> "
create table analytics1 (playerip varchar(16), handle varchar(40), email varchar(128), uuid varchar(64), playerid bigint, country varchar(64), useragent varchar(128), datestamp timestamptz, walletbalance real, playerlevel varchar(16), status varchar(16));

create table telemetry1 (datestamp timestamptz, playerid bigint, playerlevel varchar(16), squadelementmap varchar(8), gamenumber int, squadpower int, squadagility int, squadhealth int, squadluck int, squadspecial int, squadguard int, squaddamage int, gameplayseconds int, bosspower int, bossagility int, bosshealth int, bossluck int, bossspecial int, bossguard int, bossdamage int, result varchar(8));

create table telemetry2 (playerid bigint, playerlevel varchar(16), squadelementmap varchar(8), gamenumber int, squadpower int, squadagility int, squadhealth int, squadluck int, squadspecial int, squadguard int, squaddamage int, gameplayseconds int, bosspower int, bossagility int, bosshealth int, bossluck int, bossspecial int, bossguard int, bossdamage int, result varchar(8));
</div>
						</p>
						</div><br />
						<p> Don't forget to issue a 'quit' after you've created your tables so the script can continue building your services!</p>

						<h3 class="overline">PIPELINE 1 - FIRE UP YOUR GAME BOT!</h3>
						<p>Let's fire up your game bot! You have a little web application installed on your bastion host that will propagate data from your EC2 instance to Kinesis.</p>
							<p>1. Visit <a href="https://us-west-2.console.aws.amazon.com/cloudformation/home?region=us-west-2#/stacks?filter=active&tab=outputs" target="_blank">this link</a> if you don't already have your CloudFormation Output parameters open. Click on the CloudFormation stack "<span class="bold">GamingWorkshopStack</span>". Click on the URL from the "<span class="bold">GameBotURL</span>" Output of this Stack. This will open a website hosted on your EC2 instance where the GameBot resides.</p>
							<p>2. Click on the "<span class="bold">Generate</span>" button. This will start a bot that generates and submits data to your "<span class="bold">workShopTelemetryStream</span>" Amazon Kinesis Stream. Another window will appear showing the data being sent. Please notify a staff member if you have any error messages. You should see numerous messages saying "Pushing to kinesis a batch of...". Click the "<span class="bold">Generate</span>" button a few times to give you some more data.</p>
							<p>3. Click on the drop-down menu on the top and select "<span class="bold">telemetry1-1</span>", then click the "<span class="bold">Load configuration profile</span>" button. This will change the stream that you're pushing data to. Click the "<span class="bold">Generate</span>" button to push data to the "<span class="bold">workshopTelemetryStream</span>"</p>
							<p>4. Click on the "<span class="bold">Sending in loop</span>" checkbox, then click on the "<span class="bold">Generate</span>" button to start pushing a constant stream of data to Kinesis</p>
							<p>5. Check the <a href="https://us-west-2.console.aws.amazon.com/kinesis/home?region=us-west-2#/streams/details?streamName=workshopTelemetryStream" target="_blank">AWS Kinesis console</a> monitoring window to see your data propagating.</p>
							<p>It will take a few minutes for Firehose to push the data to Redshift.<br /><br />
							<p>6. You can check the data is being pushed in by running a query like this in your PGCLI terminal (you can access it using the "ClusterEndpointConnectCmd" from your CloudFormation Outputs):</p>
								<div id="code6">-- Check for 10 rows of data in your telemetry1 table
SELECT * FROM telemetry1 LIMIT 10;
</div></p>
							<p>You can also visit the <a href="https://us-west-2.console.aws.amazon.com/firehose/home?region=us-west-2#/details/workshopTelemetryFH" target="_blank">Kinesis Firehose Monitoring page</a> to monitor your <span class="bold">workshopTelemetryFH</span> Delivery Stream.</p>
							<p>7. Run another query in PGCLI to see what the win rate looks like:</p>
							<div id="code7">-- This query shows you the percentage of wins, losses, and DNFs (Did Not Finish)
select result, count(result), (((cast(count(result) as decimal)/(select count(*) from telemetry1)))*100.00) as percentage from telemetry1 group by result;
</div>
							<p>You will notice that the Losses and DNFs are very high, and the Wins are very low. This isn't a good player experience and implies that there is a game balancing issue. Try making a change to the game telemetry parameters to see how they effect the proportions of wins.</p>
							<p>8. Click on the "<span class="bold">telemetry1-1</span> drop-down and change it to "<span class="bold">telemetry1-2</span>", then click "Load configuration profile". This applies a different profile that increases the player parameters. Feel free to change the JSON if you want to experiment with how the numbers affect the win rate. Run the same query as before to see how the win rate changes.
							</p>
							<div id="code8">-- This query shows you the percentage of wins, losses, and DNFs (Did Not Finish)
select result, count(result), (((cast(count(result) as decimal)/(select count(*) from telemetry1)))*100.00) as percentage from telemetry1 group by result;
</div>
						<p>After a few minutes of the data from telemetry1-2 propagating, you should see the changes in the win rate.</p>

						<h3 class="overline">PIPELINE 1 - SET UP QUICKSIGHT</h3>
						<p>Let's get QuickSight working! Please visit QuickSight, connect to the Redshift table you've created, and experiment with graphing the data. Full instructions are below.</p>
						<div class="indent-show" id="1-3-button"><div class="expand"><a class="border" href="javascript:void();" onClick="reveal('1-3-button', '1-3-content')">CLICK TO TOGGLE INSTRUCTIONS</a></div></div>
						<div class="indent-hide" id="1-3-content">
							<p>1. Click on <a href="https://quicksight.aws.amazon.com/" target="_blank">this link</a> to visit the QuickSight website or select "<span class="bold">QuickSight</span>" in the Console.</p>
							<p>2. Select "<span class="bold">Sign Up For Free</span>" (or "Sign In" if you've used it before and have an account)</p>
							<p>3. Select "<span class="bold">Continue</span>" to select the Standard edition (NEW USERS ONLY)</p>
							<p>4. Enter your name and email address, and for the "QuickSight capacity region" select "US West (Oregon)" and click "<span class="bold">Finish</span>". Leave everything else as defaults (NEW USERS ONLY). If you're an existing user, switch to the Oregon region.</p>
							<p>5. Click the "<span class="bold">Go to Amazon QuickSight</span>" button (NEW USERS ONLY)</p>
							<p>6. Click the "<span class="bold">New analysis</span>" button in the top left</p>
							<p>7. Click the "<span class="bold">New data set</span>" button in the top left</p>
							<p>8. Click the "<span class="bold">Redshift - Auto-discovered</span>" button</p>
							<p>9. A "<span class="bold">New Redshift data source</span>" window will appear. For the "<span class="bold">Data source name</span>" enter "<span class="bold">GamingWorkshopRedshift</span>". For "Instance ID" click the drop-down arrow on the right of the selection box, and select "<span class="bold">workshopcluster</span>". The "<span class="bold">Database name</span>" should be automatically populated with "workshopdb", but you will need to enter a "<span class="bold">Username</span>" of "<span class="bold">wsuser</span>" and "<span class="bold">Password</span>" of "<span class="bold">wsPassword0</span>". Click the "Validate" button on the bottom left of the window. This should turn to "Validated" with a green tick if you're successful. Click "Create data source".</p>
							<p>10. Select "<span class="bold">analytics1</span>" and click the "<span class="bold">Select</span>" button on the bottom right</p>
							<p>11. Select "<span class="bold">Directly query your data</span>" and click the "<span class="bold">Visualize</span>" button on the bottom right</p>
							<p>12. Explore your data! Let's start with by looking at the average walletbalance per country. Click on "<span class="bold">walletbalance</span>" in the list on the left. QuickSight will automatically select a graph type once after you select your next measure.</p>
							<p>13. Select "<span class="bold">country</span>" from the left side, and QuickSight will show you the "Count of records by Country"</p>
							<p>14. Click the chevron in the top-right side to expand the Field wells</p>
							<p>15. Click and drag "<span class="bold">walletbalance</span>" to the "Value" field well</p>
							<p><img src="P1Step15.png" alt="Avg Wallet Balance by Country" /></p>
							<p>16. Click on the chevron next to the "Value" field well, and change the "Aggregate: Sum" to "Average"</p>
							<p>17. Click and drag "<span class="bold">playerlevel</span>" to the "Group/Color" field well. This shows you the average wallet balance for each player level within each country.</p>
							<p><img src="P1Step17.png" alt="Avg Wallet Balance by player level by Country" /></p>
							<p>Feel free to keep exploring QuickSight with your GameBot data set.</p>
						</div>

						<h3 class="overline">PROCEED TO LAB 2</h3>
						<p>You've now completed Lab 1!</p>
						<p>Note: When a reasonable amount of participants have progressed to this point, we will pause and present some slides explaining the next lab.</p>
						<p>If you're keen, it's perfectly fine to proceed - but it's recommended that you hit the button below and then take a break for a moment until a reasonable number of participants are ready to proceed.</p>
						<div class="indent-show" id="next-lab-button"><div class="expand"><a class="border" href="javascript:void();" onClick="nextLab('2','2')">PROCEED TO LAB 2</a></div></div>
					</div>
				</div>
			</div>
		</section>
	</div>
</main>

		</div>
	</div>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.9/ace.js"></script>
	<script>
		var code1 = ace.edit("code1");
		code1.setTheme("ace/theme/idle_fingers");
    	code1.getSession().setMode("ace/mode/snippets");
    	// code1.getSession().setUseWrapMode(true);
    	code1.setReadOnly(false);
    	code1.setShowPrintMargin(false);
    	code1.setOptions({
    		maxLines: code1.session.getLength()
    	});
	</script>
	<script>
		var code2 = ace.edit("code2");
		code2.setTheme("ace/theme/idle_fingers");
    	code2.getSession().setMode("ace/mode/snippets");
    	code2.setReadOnly(false);
    	code2.setShowPrintMargin(false);
    	code2.setOptions({
    		maxLines: code2.session.getLength()
    	});
	</script>
	<script>
		var code3 = ace.edit("code3");
		code3.setTheme("ace/theme/idle_fingers");
    	code3.getSession().setMode("ace/mode/snippets");
    	code3.setReadOnly(true);
    	code3.setShowPrintMargin(false);
    	code3.setOptions({
    		maxLines: code3.session.getLength()
    	});
	</script>
	<script>
		var code4 = ace.edit("code4");
		code4.setTheme("ace/theme/idle_fingers");
    	code4.getSession().setMode("ace/mode/snippets");
    	code4.setReadOnly(false);
    	code4.setShowPrintMargin(false);
    	code4.setOptions({
    		maxLines: code4.session.getLength()
    	});
	</script>
	<script>
		var code5 = ace.edit("code5");
		code5.setTheme("ace/theme/idle_fingers");
    	code5.getSession().setMode("ace/mode/snippets");
    	code5.setReadOnly(false);
    	code5.setShowPrintMargin(false);
    	code5.setOptions({
    		maxLines: code5.session.getLength()
    	});
	</script>
	<script>
		var code6 = ace.edit("code6");
		code6.setTheme("ace/theme/idle_fingers");
    	code6.getSession().setMode("ace/mode/snippets");
    	code6.setReadOnly(false);
    	code6.setShowPrintMargin(false);
    	code6.setOptions({
    		maxLines: code6.session.getLength()
    	});
	</script>
	<script>
		var code7 = ace.edit("code7");
		code7.setTheme("ace/theme/idle_fingers");
    	code7.getSession().setMode("ace/mode/snippets");
    	code7.setReadOnly(false);
    	code7.setShowPrintMargin(false);
    	code7.setOptions({
    		maxLines: code7.session.getLength()
    	});
	</script>
	<script>
		var code8 = ace.edit("code8");
		code8.setTheme("ace/theme/idle_fingers");
    	code8.getSession().setMode("ace/mode/snippets");
    	code8.setReadOnly(false);
    	code8.setShowPrintMargin(false);
    	code8.setOptions({
    		maxLines: code8.session.getLength()
    	});
	</script>
</body>

</html>